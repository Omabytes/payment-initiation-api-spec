swagger: '2.0'
info:
  title: Read Write APIs
  description: Draft Swagger specification for Read Write
  contact:
    name: Claudio Viola
    email: claudio.viola@openbanking.org.uk
  version: v0.1
basePath: /open-banking
schemes:
  - https
produces:
  - application/prs.openbanking.rwdata.v0.1+json
paths:
  /payments:
    post:
      tags:
        - Payments
      summary: Setup a single immediate payment
      description: Setup a single immediate payment
      operationId: SetupSingleImmediatePayment
      consumes:
        - application/prs.openbanking.rwdata.v0.1+json
      produces:
        - application/prs.openbanking.rwdata.v0.1+json
      parameters:
        - name: body
          in: body
          description: Setup a single immediate payment
          required: true
          schema:
            title: Payment setup POST request
            description: Allows setup of a payment
            type: object
            properties:
              InstructionIdentification:
                description: >-
                  Unique identification as assigned by an instructing party for an instructed party to unambiguously identify the instruction. Usage: the  instruction identification is a point to
                  point reference that can be used between the instructing party and the instructed party to refer to the individual instruction. It can be included in several messages related to the
                  instruction.
                type: string
                minLength: 1
                maxLength: 35
              EndToEndIdentification:
                description: >-
                  Unique identification assigned by the initiating party to unambiguously identify the transaction. This identification is passed on, unchanged, throughout the entire end-to-end chain.
                  Usage: The end-to-end identification can be used for reconciliation or to link tasks relating to the transaction. It can be included in several messages related to the transaction.
                type: string
                minLength: 1
                maxLength: 35
              RemittanceInformation:
                description: >-
                  Information supplied to enable the matching/reconciliation of an entry with the items that the payment is intended to settle, such as commercial invoices in an accounts' receivable
                  system, in an unstructured form.
                type: string
                minLength: 1
                maxLength: 140
              InstructedAmount:
                description: >-
                  Amount of money to be moved between the debtor and creditor, before deduction of charges, expressed in the currency as ordered by the initiating party. Usage: This amount has to be
                  transported unchanged through the transaction chain.
                type: object
                properties:
                  Amount:
                    type: string
                    pattern: '^-?\d{1,13}\.\d{1,5}$'
                  Currency:
                    description: >-
                      A code allocated to a currency by a Maintenance Agency under an international identification scheme, as described in the latest edition of the international standard ISO 4217
                      'Codes for the representation of currencies and funds'
                    type: string
                    pattern: '^[A-Z]{3}$'
                required:
                  - Amount
                  - Currency
                additionalProperties: false
              DebtorAgent:
                description: Financial institution servicing an account for the debtor.
                type: object
                properties:
                  SchemeName:
                    description: Specifies the external financial institution identification scheme name code in the format of character string.
                    type: string
                    enum:
                      - UKSortCode
                  Identification:
                    description: >-
                      United Kingdom (UK) Sort Code - identifies British financial institutions on the British national clearing systems. The sort code is assigned by the Association for Payments and
                      Clearing Services (APACS).
                    type: string
                    pattern: '^SC[0-9]{6,6}$'
                required:
                  - SchemeName
                  - Identification
                additionalProperties: false
              DebtorAccount:
                description: Unambiguous identification of the account of the debtor to which a debit entry will be made as a result of the transaction.
                type: object
                properties:
                  SchemeName:
                    description: 'Name of the identification scheme, in a coded form as published in an external list.'
                    type: string
                    enum:
                      - BBAN
                  Identification:
                    description: maxLength 34 text
                    type: string
                    minLength: 1
                    maxLength: 34
                  Name:
                    description: maxLength 70 text
                    type: string
                    minLength: 1
                    maxLength: 70
                required:
                  - SchemeName
                  - Identification
                additionalProperties: false
              CreditorAgent:
                description: Financial institution servicing an account for the creditor.
                type: object
                properties:
                  SchemeName:
                    description: Specifies the external financial institution identification scheme name code in the format of character string.
                    type: string
                    enum:
                      - UKSortCode
                  Identification:
                    description: >-
                      United Kingdom (UK) Sort Code - identifies British financial institutions on the British national clearing systems. The sort code is assigned by the Association for Payments and
                      Clearing Services (APACS).
                    type: string
                    pattern: '^SC[0-9]{6,6}$'
                required:
                  - SchemeName
                  - Identification
                additionalProperties: false
              CreditorAccount:
                description: Unambiguous identification of the account of the creditor to which a credit entry will be posted as a result of the payment transaction.
                type: object
                properties:
                  SchemeName:
                    description: 'Name of the identification scheme, in a coded form as published in an external list.'
                    type: string
                    enum:
                      - BBAN
                  Identification:
                    description: maxLength 34 text
                    type: string
                    minLength: 1
                    maxLength: 34
                  Name:
                    description: maxLength 70 text
                    type: string
                    minLength: 1
                    maxLength: 70
                required:
                  - SchemeName
                  - Identification
                additionalProperties: false
            required:
              - InstructionIdentification
              - EndToEndIdentification
              - InstructedAmount
              - CreditorAgent
              - CreditorAccount
            additionalProperties: false
      responses:
        '200':
          description: Payment setup successfully
          schema:
            title: Payment setup POST 200 Response
            type: object
            properties:
              PaymentAuthorisationID:
                description: ASPSP authorisation identifier for the payment
                type: string
                minLength: 1
                maxLength: 35
            required:
              - PaymentAuthorisationID
            additionalProperties: false
        '400': &ref_0
          description: Bad Request
          schema:
            title: HTTP 400 Error
            type: object
            properties:
              status:
                type: string
                enum:
                  - '400'
              title:
                type: string
                enum:
                  - BadRequest
              description:
                type: string
                enum:
                  - The request could not be understood by the server due to malformed syntax. The client SHOULD NOT repeat the request without modifications.
            required:
              - status
              - title
              - description
            additionalProperties: false
        '401': &ref_1
          description: Unauthorized
          schema:
            title: HTTP 401 Error
            type: object
            properties:
              status:
                type: string
                enum:
                  - '401'
              title:
                type: string
                enum:
                  - Unauthorised
              description:
                type: string
                enum:
                  - The request requires user authentication.
            required:
              - status
              - title
              - description
            additionalProperties: false
        '403': &ref_4
          description: Forbidden
          schema:
            title: HTTP 403 Error
            type: object
            properties:
              status:
                type: string
                enum:
                  - '403'
              title:
                type: string
                enum:
                  - Forbidden
              description:
                type: string
                enum:
                  - 'The server understood the request, but is refusing to fulfill it. Authorization will not help and the request SHOULD NOT be repeated.'
            required:
              - status
              - title
              - description
            additionalProperties: false
        '409': &ref_5
          description: Conflict
          schema:
            title: HTTP 409 Error
            type: object
            properties:
              status:
                type: string
                enum:
                  - '409'
              title:
                type: string
                enum:
                  - Conflict
              description:
                type: string
                enum:
                  - The request could not be completed due to a conflict with the current state of the resource.
            required:
              - status
              - title
              - description
            additionalProperties: false
        '500': &ref_2
          description: Internal Server Error
          schema:
            title: HTTP 500 Error
            type: object
            properties:
              status:
                type: string
                enum:
                  - '500'
              title:
                type: string
                enum:
                  - InternalServerError
              description:
                type: string
                enum:
                  - The server encountered an unexpected condition which prevented it from fulfilling the request.
            required:
              - status
              - title
              - description
            additionalProperties: false
      security:
        - TPPOAuth2Security:
            - tpp_client_credential
  '/payments/{PaymentAuthorisationID}':
    patch:
      tags:
        - Payments
      summary: Submit a single immediate payment
      description: Submit a previously setup single immediate payment
      operationId: SubmitSingleImmediatePayment
      consumes:
        - application/prs.openbanking.rwdata.v0.1+json
      produces:
        - application/prs.openbanking.rwdata.v0.1+json
      parameters:
        - &ref_3
          name: PaymentAuthorisationID
          in: path
          description: ASPSP authorisation identifier for the payment
          required: true
          type: string
      responses:
        '200':
          description: Payment executed or ready for scheme to execute.
          schema:
            title: Payment submit PATCH 200 response
            type: object
            properties:
              PaymentStatus:
                type: string
                enum:
                  - AwaitingExecution
                  - InProgress
                  - Debited
                  - AwaitingFurtherAuthorisation
                  - CreditSent
                  - CreditDelivered
                  - CreditApplied
                  - CreditRejected
              PaymentStatusDescription:
                type: string
                enum:
                  - Queued for processing by debtor bank – outcome unknown
                  - Payment being processed by debtor bank – outcome unknown
                  - 'Debit applied to debtor account, awaiting send to scheme'
                  - 'The payment failed, credit will never be applied at the beneficiary'
                  - Multi-party authorisation is required for the payment
                  - Payment sent to scheme
                  - Payment arrived at beneficiary bank
                  - The credit has been applied at the beneficiary bank
                  - The credit was rejected at the beneficiary bank
              PaymentReferenceID:
                description: Payment Reference ID
                type: string
                minLength: 1
                maxLength: 35
            required:
              - PaymentStatus
              - PaymentStatusDescription
            additionalProperties: false
        '202':
          description: Payment execution instruction accepted.
          schema:
            title: Payment submit PATCH 202 response
            type: object
            properties:
              PaymentStatus:
                type: string
                enum:
                  - InstructionReceived
              PaymentStatusDescription:
                type: string
                enum:
                  - Payment execution instruction accepted.
              PaymentReferenceID:
                description: Payment Reference ID
                type: string
                minLength: 1
                maxLength: 35
            required:
              - PaymentStatus
              - PaymentStatusDescription
            additionalProperties: false
        '400': *ref_0
        '401': *ref_1
        '403':
          description: Forbidden
          schema:
            title: Payment submit PATCH 403 response
            type: object
            properties:
              status:
                type: string
                enum:
                  - '403'
              title:
                type: string
                enum:
                  - InvalidPayerSortCode
                  - InvalidPayerAccount
                  - InvalidPayeeSortCode
                  - InvalidPayeeAccount
                  - InvalidAmount
                  - InvalidExecutionDate
                  - SchemeReject
                  - SendingInstitutionReject
                  - ReceivingInstitutionReject
              description:
                type: string
                enum:
                  - 'The payer sort code is not valid - is closed, does not exist, or is not valid for the scheme.'
                  - 'The payer account is not valid - is closed, does not exist, or is not valid for the scheme.'
                  - 'The payee sort code is not valid - is closed, does not exist, or is not valid for the scheme.'
                  - 'The payee account is not valid - is closed, does not exist, or is not valid for the scheme.'
                  - The amount is not valid - exceeds scheme limit.
                  - The date is too far in the future.
                  - The scheme has rejected payment for an unspecified reason.
                  - The sending institution has rejected payment for an unspecified reason.
                  - The receiving institution has rejected payment for an unspecified reason.
            required:
              - status
              - title
              - description
            additionalProperties: false
        '409':
          description: Conflict
          schema:
            title: Payment submit PATCH 409 response
            type: object
            properties:
              status:
                type: string
                enum:
                  - '409'
              title:
                type: string
                enum:
                  - SendingInstitutionReject
              description:
                type: string
                enum:
                  - The sending institution has rejected payment for an unspecified reason.
            required:
              - status
              - title
              - description
            additionalProperties: false
        '500': *ref_2
      security:
        - PSUOAuth2Security:
            - payment
  '/payments/{PaymentAuthorisationID}/status':
    get:
      tags:
        - Payments
      summary: Get the status of a payment
      description: Get status of a previously submitted  payment
      operationId: GetPaymentStatus
      produces:
        - application/prs.openbanking.rwdata.v0.1+json
      parameters:
        - *ref_3
      responses:
        '200':
          description: Payment Status Response
          schema:
            title: Payment status GET 200 response
            type: object
            properties:
              PaymentStatus:
                type: string
                enum:
                  - AwaitingExecution
                  - InProgress
                  - Debited
                  - AwaitingFurtherAuthorisation
                  - CreditSent
                  - CreditDelivered
                  - CreditApplied
                  - CreditRejected
              PaymentStatusDescription:
                type: string
                enum:
                  - Queued for processing by debtor bank – outcome unknown
                  - Payment being processed by debtor bank – outcome unknown
                  - 'Debit applied to debtor account, awaiting send to scheme'
                  - 'The payment failed, credit will never be applied at the beneficiary'
                  - Multi-party authorisation is required for the payment
                  - Payment sent to scheme
                  - Payment arrived at beneficiary bank
                  - The credit has been applied at the beneficiary bank
                  - The credit was rejected at the beneficiary bank
              PaymentReferenceID:
                description: Payment Reference ID
                type: string
                minLength: 1
                maxLength: 35
            required:
              - PaymentStatus
              - PaymentStatusDescription
            additionalProperties: false
      security:
        - PSUOAuth2Security:
            - payment
securityDefinitions:
  PSUOAuth2Security:
    type: oauth2
    flow: accessCode
    tokenUrl: /token
    authorizationUrl: /authorization
    scopes:
      payment: Generic payment scope
    description: 'OAuth flow, it is required when the PSU needs to perform SCA with the ASPSP when a TPP wants to access an ASPSP resource owned by the PSU'
  TPPOAuth2Security:
    type: oauth2
    flow: application
    tokenUrl: /token
    scopes:
      tpp_client_credential: TPP Client Credential Scope
    description: TPP client credential authorisation flow with the ASPSP
tags:
  - name: Payments
    description: Payments endpoints
responses:
  400ErrorResponse: *ref_0
  401ErrorResponse: *ref_1
  403ErrorResponse: *ref_4
  409ErrorResponse: *ref_5
  500ErrorResponse: *ref_2
